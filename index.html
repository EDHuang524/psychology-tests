<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒç†æµ‹è¯„ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            padding: 40px 0;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* éªŒè¯ç è¾“å…¥åŒºåŸŸ */
        .code-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            margin: 0 auto 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }
        .code-section h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .code-section p {
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }
        .code-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .code-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 3px;
            text-transform: uppercase;
            transition: border-color 0.3s;
        }
        .code-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn-verify {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-verify:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .error-msg {
            color: #e74c3c;
            margin-top: 15px;
            display: none;
        }
        .success-msg {
            color: #27ae60;
            margin-top: 15px;
            display: none;
        }

        /* æµ‹è¯•å¡ç‰‡åŒºåŸŸ - é»˜è®¤éšè— */
        .tests-section {
            display: none;
        }
        .tests-section.show {
            display: block;
        }
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }
        .test-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .test-icon {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        .test-card.scl90 .test-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .test-card.mbti .test-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .test-card.apt .test-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .test-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .test-desc {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        .test-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #95a5a6;
        }
        .test-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .btn-start {
            display: inline-block;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
        }
        .test-card.mbti .btn-start { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .test-card.apt .btn-start { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .btn-start:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .footer {
            text-align: center;
            color: white;
            padding: 30px 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* å·²éªŒè¯æ ‡è¯† */
        .verified-badge {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .tests-grid { grid-template-columns: 1fr; }
            .code-input-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å¿ƒç†æµ‹è¯„ç³»ç»Ÿ</h1>
            <p>ä¸“ä¸šçš„å¿ƒç†å¥åº·è¯„ä¼°å·¥å…·ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£è‡ªå·±</p>
        </div>

        <!-- è®¿é—®ç éªŒè¯åŒºåŸŸ -->
        <div class="code-section" id="codeSection">
            <h2>è¯·è¾“å…¥è®¿é—®ç </h2>
            <p>è¾“å…¥æ‚¨è´­ä¹°æ—¶è·å¾—çš„è®¿é—®ç ä»¥å¼€å§‹æµ‹è¯•</p>
            <div class="code-input-group">
                <input type="text" class="code-input" id="accessCode" placeholder="è¯·è¾“å…¥è®¿é—®ç " maxlength="12">
            </div>
            <button class="btn-verify" onclick="verifyCode()">éªŒè¯å¹¶è¿›å…¥</button>
            <p class="error-msg" id="errorMsg">è®¿é—®ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•</p>
            <p class="success-msg" id="successMsg">éªŒè¯æˆåŠŸï¼æ­£åœ¨è¿›å…¥...</p>
        </div>

        <!-- æµ‹è¯•åˆ—è¡¨åŒºåŸŸ - éªŒè¯åæ˜¾ç¤º -->
        <div class="tests-section" id="testsSection">
            <div style="text-align: center;">
                <span class="verified-badge">å·²éªŒè¯ - å¯ä»¥å¼€å§‹æµ‹è¯•</span>
            </div>

            <div class="tests-grid">
                <div class="test-card scl90">
                    <div class="test-icon">ğŸ“‹</div>
                    <h2 class="test-title">SCL-90 å¿ƒç†å¥åº·è‡ªè¯„é‡è¡¨</h2>
                    <p class="test-desc">ä»åä¸ªç»´åº¦å…¨é¢è¯„ä¼°å¿ƒç†å¥åº·çŠ¶å†µï¼ŒåŒ…æ‹¬èº¯ä½“åŒ–ã€å¼ºè¿«ç—‡çŠ¶ã€äººé™…å…³ç³»æ•æ„Ÿã€æŠ‘éƒã€ç„¦è™‘ç­‰æ–¹é¢ã€‚</p>
                    <div class="test-meta">
                        <span>ğŸ“ 90é¢˜</span>
                        <span>â±ï¸ çº¦15åˆ†é’Ÿ</span>
                    </div>
                    <a href="scl90.html" class="btn-start">å¼€å§‹æµ‹è¯•</a>
                </div>

                <div class="test-card mbti">
                    <div class="test-icon">ğŸ”¤</div>
                    <h2 class="test-title">MBTI 16å‹äººæ ¼æµ‹è¯•</h2>
                    <p class="test-desc">åŸºäºè£æ ¼å¿ƒç†ç±»å‹ç†è®ºï¼Œé€šè¿‡å››ä¸ªç»´åº¦åˆ†ææ‚¨çš„äººæ ¼ç‰¹ç‚¹ï¼Œå¸®åŠ©æ‚¨äº†è§£è‡ªå·±çš„æ€ç»´å’Œè¡Œä¸ºæ¨¡å¼ã€‚</p>
                    <div class="test-meta">
                        <span>ğŸ“ 93é¢˜</span>
                        <span>â±ï¸ çº¦15åˆ†é’Ÿ</span>
                    </div>
                    <a href="mbti.html" class="btn-start">å¼€å§‹æµ‹è¯•</a>
                </div>

                <div class="test-card apt">
                    <div class="test-icon">â­</div>
                    <h2 class="test-title">APT å¤©èµ‹æ½œèƒ½è¯„ä¼°ç³»ç»Ÿ</h2>
                    <p class="test-desc">å…¨é¢è¯„ä¼°æ‚¨åœ¨16ä¸ªæ ¸å¿ƒèƒ½åŠ›ç»´åº¦çš„è¡¨ç°ï¼ŒåŒ…æ‹¬åˆ›é€ åŠ›ã€æƒ…æ„Ÿæ´å¯ŸåŠ›ã€é¢†å¯¼åŠ›ã€é€»è¾‘æ¨ç†ç­‰æ–¹é¢ã€‚</p>
                    <div class="test-meta">
                        <span>ğŸ“ 60é¢˜</span>
                        <span>â±ï¸ çº¦10åˆ†é’Ÿ</span>
                    </div>
                    <a href="apt.html" class="btn-start">å¼€å§‹æµ‹è¯•</a>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸ä½œä¸ºä¸“ä¸šè¯Šæ–­ä¾æ®</p>
            <p>å¦‚æœ‰å¿ƒç†å¥åº·é—®é¢˜ï¼Œè¯·å’¨è¯¢ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆ</p>
        </div>
    </div>

    <script>
        // ========== Google Sheets API ==========
        const SHEET_API = 'https://script.google.com/macros/s/AKfycbxpu3TzhiF6sE-xKvjKTBv37qfAaLMIvPjrU8J7lyfQaUQDF0IdMBFAXDzPgDEfG5xm/exec';

        // æœ‰æ•ˆçš„è®¿é—®ç åˆ—è¡¨
        const _0x = [
            'Y49D32W4', 'ASO3GZNT', 'QHX0VEUF', 'MZO1NBAU', 'CXUWUIWR', 'XVCJDEZ1', '6T8PWPOI', 'WULAYPAD', '4TB18NZP', 'VEMCQWIE',
            'W4XLY9WE', '6O708J5A', 'ICAHE93E', '6I4EJN7M', 'T3JZ96U1', 'MU6UBD9U', 'UTEISGEC', '0ZVYHTRG', 'RNGZMXIY', 'I6TKB2RX',
            '33OWVADB', 'D1886LTC', '317T1GQU', 'RWFZXT9H', 'RXYCL3RV', 'T7R9FTNE', 'U0I26SVV', 'WTP0913B', 'HV87821J', 'VAD6NN6X',
            'XJX72U3B', 'Y1TW3CTH', 'EXCE0726', '9LN4NBPT', '2KQXYV5L', 'PYXB9WNJ', 'NPO41N9D', '7MJDPDD4', '6LLC39QA', 'CA0OX5HA',
            '7QEX1MBC', 'GMQGE3DK', '3IIYYSTB', 'NYC1EIZI', 'FWQYZVKB', '1PGQDQ2T', 'EX1T5CG7', '6052LHFW', '50JV8WAN', 'EY37E21K',
            'NAGY285P', '8PFIEJGB', 'ADJAM0XY', 'X0CILY93', 'SJUA8DFC', 'IE33YGTE', 'O1HSBNS0', 'OQCNOS0P', 'ORT8TSNP', 'CR9IJEDK',
            'IJYRI08L', 'PDAFII2R', '5P7R68LK', '2DOYFDK8', '0D7F17G3', 'Z11DLR6N', '4AL47915', 'WNXOR7KO', '6TF2051M', '9PK0TS2Z',
            'BU967G78', 'OWJNXQL7', '3TE9TZP3', 'RLRAB060', 'XOGMF70Z', '9KTW4JRD', '1DSD2R9T', 'ZP6W0LVQ', 'KLEZGS65', 'S7J7YNAP',
            'S6UL25NY', 'RHFSFL5X', 'GIOI1WTT', '1UDW8YX1', 'MKKKE4TB', '57X589MQ', 'U7F8SRA6', 'BIATK9IH', 'J9X1GT7S', 'STHNGB6G',
            '8FI7FBGG', '613TV0BT', 'QLT5ZA96', 'LG7DL18U', 'RSH2SNIW', 'JCXT4ZI1', 'VF5W80CP', 'P3GS0IST', 'LKJKH17D', 'QGRZOB5V',
            'BBHTPFCP', '8R9AYU8J', '4PZG5HYH', 'CNUN17KX', 'ZEFPTLYW', 'PMKPLYDS', 'W7J3NQT1', 'FF1BUV3A', '8FNBVFPV', 'UJTPKXZH',
            '9XYMYS7Y', '9LM9YF10', 'CFMQ79WE', 'BREUKIT8', '14U2VCRL', '1V3854XI', 'RZ2KMJ12', 'PCKKO29P', 'WHLHAFY9', 'V7Z78BXQ',
            'OLRHVE3V', 'OHM5GULZ', 'YAC3OFUB', '6THDNCUQ', 'F5RDCAFM', 'JU9S38MY', 'G8DR5Z66', 'XEDKZXP7', '3HVCLAPH', 'ZTPS1XMI',
            'KQ40GTAD', 'K46WXSGS', 'SPA7DWVE', 'X0RAG2D7', 'J7QBGVY3', '4I51WQ0O', 'RSCS3RQ0', 'KJH2VO09', 'H4L6UTUO', 'ZSX4DDTG',
            'KV45SJNJ', 'M7LQC4SW', 'RW0KIDI0', 'HZMGUZSC', 'H5E0N9P3', '15RILBGY', 'AO6ITZIF', '60N2WQHK', '8SEFBPW3', 'HHE28WN8',
            'DZNGXJ9N', '2MNEO3SO', 'K5DB2XP3', '1AUDN892', 'ZPRGLFX9', 'GJAU4A5I', 'FRFAOP35', 'C560YM1P', 'M5WRM1TU', 'C83D6UZ6',
            'O30BN2RJ', 'I5PDNCOM', 'T9KDRTQR', 'YD30MQ4T', '9ADYIX9Q', 'VRS6N6P2', 'L9KJ8Z7E', 'CR54BZP2', '6T5J5Z2B', '96PQTA93',
            'JDK8YEKF', 'EBSX05EM', 'HIGGDCGQ', 'QOB8C10I', '0GDL4LTH', 'X9XVFADG', '8E9X2KT5', 'BS8ARI5B', '01J1866A', 'FG37IL6P',
            '7MN2YPGT', 'I1F34H8R', 'D0PG0CTM', 'UXUU16Y2', 'N705FYRY', 'ER5HWBZ7', 'YNXO8FSH', 'S7XMEYEY', '4NZVB1G8', 'SPDA1RR3',
            'E7S2W5BY', '4W8V61NU', '7B76LLQ3', '61VC93RP', 'E5YKKWVH', 'TCXTKGV8', 'BDBW8LRT', 'VS67TDIL', '49QE9AZB', '8JNCAZFS'
        ];

        // ä»äº‘ç«¯è·å–å·²ä½¿ç”¨çš„ç 
        let cloudUsedCodes = [];

        async function fetchUsedCodes() {
            try {
                const response = await fetch(SHEET_API);
                const data = await response.json();
                cloudUsedCodes = data.usedCodes || [];
            } catch (e) {
                console.log('æ— æ³•è·å–äº‘ç«¯æ•°æ®ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜');
                cloudUsedCodes = [];
            }
        }

        // è®°å½•ä½¿ç”¨çš„ç åˆ°äº‘ç«¯
        async function recordCodeToCloud(code) {
            try {
                await fetch(SHEET_API, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
            } catch (e) {
                console.log('è®°å½•å¤±è´¥ï¼Œä½†ä¸å½±å“ä½¿ç”¨');
            }
        }

        function isValidCode(code) {
            const upperCode = code.toUpperCase().trim();
            // æ£€æŸ¥æ˜¯å¦åœ¨æœ‰æ•ˆåˆ—è¡¨ä¸­ä¸”æœªè¢«äº‘ç«¯è®°å½•ä½¿ç”¨
            return _0x.includes(upperCode) && !cloudUsedCodes.includes(upperCode);
        }

        async function verifyCode() {
            const input = document.getElementById('accessCode');
            const errorMsg = document.getElementById('errorMsg');
            const successMsg = document.getElementById('successMsg');
            const btn = document.querySelector('.btn-verify');
            const code = input.value.trim().toUpperCase();

            if (!code) {
                errorMsg.textContent = 'è¯·è¾“å…¥è®¿é—®ç ';
                errorMsg.style.display = 'block';
                successMsg.style.display = 'none';
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            btn.textContent = 'éªŒè¯ä¸­...';
            btn.disabled = true;

            // å…ˆä»äº‘ç«¯è·å–æœ€æ–°çš„å·²ä½¿ç”¨ç åˆ—è¡¨
            await fetchUsedCodes();

            if (isValidCode(code)) {
                // éªŒè¯æˆåŠŸ
                errorMsg.style.display = 'none';
                successMsg.style.display = 'block';

                // è®°å½•åˆ°äº‘ç«¯
                await recordCodeToCloud(code);

                // ä¿å­˜éªŒè¯çŠ¶æ€åˆ° sessionStorage
                sessionStorage.setItem('verified', 'true');
                sessionStorage.setItem('verifiedCode', code);

                // å»¶è¿Ÿæ˜¾ç¤ºæµ‹è¯•åŒºåŸŸ
                setTimeout(() => {
                    document.getElementById('codeSection').style.display = 'none';
                    document.getElementById('testsSection').classList.add('show');
                }, 800);
            } else {
                // éªŒè¯å¤±è´¥
                if (cloudUsedCodes.includes(code)) {
                    errorMsg.textContent = 'æ­¤è®¿é—®ç å·²è¢«ä½¿ç”¨';
                } else {
                    errorMsg.textContent = 'è®¿é—®ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•';
                }
                errorMsg.style.display = 'block';
                successMsg.style.display = 'none';
                input.style.borderColor = '#e74c3c';
                setTimeout(() => {
                    input.style.borderColor = '#e0e0e0';
                }, 2000);
            }

            btn.textContent = 'éªŒè¯å¹¶è¿›å…¥';
            btn.disabled = false;
        }

        // å›è½¦é”®è§¦å‘éªŒè¯
        document.getElementById('accessCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyCode();
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = async function() {
            if (sessionStorage.getItem('verified') === 'true') {
                document.getElementById('codeSection').style.display = 'none';
                document.getElementById('testsSection').classList.add('show');
            }
            // é¢„åŠ è½½å·²ä½¿ç”¨çš„ç 
            await fetchUsedCodes();
        };
    </script>
</body>
</html>
